<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CyberLabs Fortress - Labs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">CyberLabs Fortress</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="content.html">Labs</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
          <li class="nav-item"><a class="nav-link nav-auth" id="authLink" href="login.html">Login</a></li>
          <li class="nav-item d-none" id="profileLink"><a class="nav-link" href="profile.html">Profile</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Labs List -->
  <section class="container my-5">
    <h2 class="text-center mb-4">Cybersecurity Labs</h2>
    
    <!-- Search and Filter Controls -->
    <div class="row mb-4">
      <div class="col-md-5">
        <div class="input-group">
          <input type="text" id="searchInput" class="form-control" placeholder="Search labs...">
          <button class="btn btn-outline-secondary" type="button" id="searchButton">
            <i class="bi bi-search"></i> Search
          </button>
        </div>
      </div>
      <div class="col-md-3">
        <select id="difficultyFilter" class="form-select">
          <option value="all">All Difficulties</option>
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>
      <div class="col-md-4">
        <select id="categoryFilter" class="form-select">
          <option value="all">All Categories</option>
          <option value="Windows Forensics">Windows Forensics</option>
          <option value="Network Analysis">Network Analysis</option>
          <option value="Malware Analysis">Malware Analysis</option>
          <option value="Memory Forensics">Memory Forensics</option>
        </select>
      </div>
    </div>
    
    <!-- Category Quick Filters -->
    <div class="category-filter mb-4">
      <span class="me-2">Quick filters:</span>
      <button class="btn btn-sm btn-outline-primary category-btn" data-category="all">All Labs</button>
      <button class="btn btn-sm btn-outline-success category-btn" data-category="Windows Forensics">Windows Forensics</button>
      <button class="btn btn-sm btn-outline-info category-btn" data-category="Network Analysis">Network Analysis</button>
      <button class="btn btn-sm btn-outline-warning category-btn" data-category="Malware Analysis">Malware Analysis</button>
      <button class="btn btn-sm btn-outline-secondary category-btn" data-category="Memory Forensics">Memory Forensics</button>
    </div>
    
    <div class="row" id="labsContainer">
      <!-- Lab Cards will be dynamically populated -->
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-dark text-light text-center py-3">
    <p>&copy; 2025 CyberLabs Fortress. All Rights Reserved.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="scripts/auth.js"></script>
  <script src="scripts/common.js"></script>
  <script>
    // Lab data with categories
    const labs = [
      {
        id: 1,
        title: "Lab 1: Prefetch File Analysis",
        description: "Analyze Prefetch files for program execution artifacts.",
        difficulty: "beginner",
        category: "Windows Forensics",
        link: "lab-1.html"
      },
      {
        id: 2,
        title: "Lab 2: ShimCache Analysis",
        description: "Examine application compatibility cache entries.",
        difficulty: "intermediate",
        category: "Windows Forensics",
        link: "lab-2.html"
      },
      {
        id: 3,
        title: "Lab 3: Browser History Forensics",
        description: "Investigate browser artifacts for activity analysis.",
        difficulty: "beginner",
        category: "Windows Forensics",
        link: "lab-3.html"
      },
      {
        id: 4,
        title: "Lab 4: Amcache Analysis",
        description: "Inspect Amcache entries for program installations.",
        difficulty: "intermediate",
        category: "Windows Forensics",
        link: "lab-4.html"
      },
      {
        id: 5,
        title: "Lab 5: LNK File Analysis",
        description: "Identify evidence of file and program usage.",
        difficulty: "beginner",
        category: "Windows Forensics",
        link: "lab-5.html"
      },
      {
        id: 6,
        title: "Lab 6: Event Log Review",
        description: "Analyze Windows event logs for anomalies.",
        difficulty: "advanced",
        category: "Windows Forensics",
        link: "lab-6.html"
      },
      {
        id: 7,
        title: "Lab 7: Registry Persistence",
        description: "Uncover persistence mechanisms in registry keys.",
        difficulty: "intermediate",
        category: "Windows Forensics",
        link: "lab-7.html"
      },
      {
        id: 8,
        title: "Lab 8: Recycle Bin Artifacts",
        description: "Investigate deleted file activity.",
        difficulty: "beginner",
        category: "Windows Forensics",
        link: "lab-8.html"
      },
      {
        id: 9,
        title: "Lab 9: PowerShell Execution Analysis",
        description: "Trace malicious PowerShell activity.",
        difficulty: "advanced",
        category: "Windows Forensics",
        link: "lab-9.html"
      },
      {
        id: 10,
        title: "Lab 10: MFT Timeline Analysis",
        description: "Use MFT entries to reconstruct activity timeline.",
        difficulty: "advanced",
        category: "Windows Forensics",
        link: "lab-10.html"
      },
      {
        id: 11,
        title: "Lab 11: Network Traffic Analysis",
        description: "Analyze PCAP files for suspicious activity.",
        difficulty: "intermediate",
        category: "Network Analysis",
        link: "lab-11.html"
      },
      {
        id: 12,
        title: "Lab 12: DNS Investigation",
        description: "Examine DNS logs for malicious domains.",
        difficulty: "beginner",
        category: "Network Analysis",
        link: "lab-12.html"
      },
      {
        id: 13,
        title: "Lab 13: HTTP Attack Analysis",
        description: "Identify web-based attacks from server logs.",
        difficulty: "advanced",
        category: "Network Analysis",
        link: "lab-13.html"
      },
      {
        id: 14,
        title: "Lab 14: Firewall Log Analysis",
        description: "Review firewall logs for policy violations.",
        difficulty: "intermediate",
        category: "Network Analysis",
        link: "lab-14.html"
      },
      {
        id: 15,
        title: "Lab 15: IDS Alert Triage",
        description: "Prioritize and investigate IDS alerts.",
        difficulty: "advanced",
        category: "Network Analysis",
        link: "lab-15.html"
      },
      {
        id: 16,
        title: "Lab 16: Malware Static Analysis",
        description: "Analyze malware without execution.",
        difficulty: "intermediate",
        category: "Malware Analysis",
        link: "lab-16.html"
      },
      {
        id: 17,
        title: "Lab 17: Malware Dynamic Analysis",
        description: "Execute malware in a sandboxed environment.",
        difficulty: "advanced",
        category: "Malware Analysis",
        link: "lab-17.html"
      },
      {
        id: 18,
        title: "Lab 18: YARA Rule Creation",
        description: "Create detection rules for malware families.",
        difficulty: "intermediate",
        category: "Malware Analysis",
        link: "lab-18.html"
      },
      {
        id: 19,
        title: "Lab 19: Memory Acquisition",
        description: "Capture RAM from a live system.",
        difficulty: "beginner",
        category: "Memory Forensics",
        link: "lab-19.html"
      },
      {
        id: 20,
        title: "Lab 20: Memory Analysis with Volatility",
        description: "Analyze memory dumps for evidence of compromise.",
        difficulty: "advanced",
        category: "Memory Forensics",
        link: "lab-20.html"
      }
    ];

    // Render labs based on filters
    function renderLabs(filteredLabs = labs) {
      const container = document.getElementById('labsContainer');
      let html = '';
      
      // Get current user progress
      const currentUser = getCurrentUsername();
      const user = currentUser ? getCurrentUserObj() : null;
      const progress = user ? user.progress || {} : {};
      
      filteredLabs.forEach(lab => {
        let badgeClass = 'badge-beginner';
        if (lab.difficulty === 'intermediate') badgeClass = 'badge-intermediate';
        if (lab.difficulty === 'advanced') badgeClass = 'badge-advanced';
        
        // Check if lab is completed
        const labProgress = progress[`lab${lab.id}`];
        const isCompleted = labProgress && labProgress.completedOverall;
        const statusBadge = isCompleted ? 
          '<span class="badge bg-success ms-2">Completed</span>' : '';
        
        html += `
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">${lab.title} ${statusBadge}</h5>
                <p class="card-text">${lab.description}</p>
                <div class="mb-2">
                  <span class="badge ${badgeClass}">${lab.difficulty.charAt(0).toUpperCase() + lab.difficulty.slice(1)}</span>
                  <span class="badge badge-category">${lab.category}</span>
                </div>
                <a href="${lab.link}" class="btn btn-primary float-end">Start Lab</a>
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html || '<div class="col-12 text-center"><p>No labs match your search criteria.</p></div>';
    }

    // Filter labs based on search, difficulty and category
    function filterLabs() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const difficulty = document.getElementById('difficultyFilter').value;
      const category = document.getElementById('categoryFilter').value;
      
      const filteredLabs = labs.filter(lab => {
        const matchesSearch = lab.title.toLowerCase().includes(searchTerm) || 
                             lab.description.toLowerCase().includes(searchTerm);
        const matchesDifficulty = difficulty === 'all' || lab.difficulty === difficulty;
        const matchesCategory = category === 'all' || lab.category === category;
        
        return matchesSearch && matchesDifficulty && matchesCategory;
      });
      
      renderLabs(filteredLabs);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      renderLabs();
      
      // Set up event listeners
      document.getElementById('searchInput').addEventListener('input', filterLabs);
      document.getElementById('difficultyFilter').addEventListener('change', filterLabs);
      document.getElementById('categoryFilter').addEventListener('change', filterLabs);
      document.getElementById('searchButton').addEventListener('click', filterLabs);
      
      // Set up category quick filters
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          document.getElementById('categoryFilter').value = category;
          filterLabs();
        });
      });
    });
  </script>
</body>
</html>
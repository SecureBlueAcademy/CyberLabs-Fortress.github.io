<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CyberLabs Fortress - Labs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">CyberLabs Fortress</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="content.html">Labs</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
          <li class="nav-item d-none" id="profileLink"><a class="nav-link" href="profile.html">Profile</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Labs List -->
  <section class="container my-5">
    <h2 class="text-center mb-4">BlueTeam Labs</h2>
    
    <!-- Search and Filter Controls -->
    <div class="row mb-4">
      <div class="col-md-5">
        <div class="input-group">
          <input type="text" id="searchInput" class="form-control" placeholder="Search labs...">
          <button class="btn btn-outline-secondary" type="button" id="searchButton">
            <i class="bi bi-search"></i> Search
          </button>
        </div>
      </div>
      <div class="col-md-3">
        <select id="difficultyFilter" class="form-select">
          <option value="all">All Difficulties</option>
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>
      <div class="col-md-4">
        <select id="categoryFilter" class="form-select">
          <option value="all">All Categories</option>
          <option value="Windows Forensics">Windows Forensics</option>
          <option value="Network Analysis">Network Analysis</option>
          <option value="Malware Analysis">Malware Analysis</option>
          <option value="Memory Forensics">Memory Forensics</option>
        </select>
      </div>
    </div>
    
    <!-- Category Quick Filters -->
    <div class="category-filter mb-4">
      <span class="me-2">Quick filters:</span>
      <button class="btn btn-sm btn-outline-primary category-btn" data-category="all">All Labs</button>
      <button class="btn btn-sm btn-outline-success category-btn" data-category="Windows Forensics">Windows Forensics</button>
      <button class="btn btn-sm btn-outline-info category-btn" data-category="Network Analysis">Network Analysis</button>
      <button class="btn btn-sm btn-outline-warning category-btn" data-category="Malware Analysis">Malware Analysis</button>
      <button class="btn btn-sm btn-outline-secondary category-btn" data-category="Memory Forensics">Memory Forensics</button>
    </div>
    
    <div class="row" id="labsContainer">
      <!-- Lab Cards will be dynamically populated -->
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-dark text-light text-center py-3">
    <p>&copy; 2025 CyberLabs Fortress. All Rights Reserved.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="scripts/auth.js"></script>
  <script src="scripts/common.js"></script>
  <script>
    // Get labs from localStorage
    function getLabs() {
      try {
        return JSON.parse(localStorage.getItem('clf_labs')) || [];
      } catch (e) {
        return [];
      }
    }

    // Get default labs if none exist
    function getDefaultLabs() {
      return [
        {
          id: "lab1",
          title: "Lab 1: Prefetch File Analysis",
          description: "Analyze Prefetch files for program execution artifacts.",
          difficulty: "beginner",
          category: "Windows Forensics",
          link: "lab1.html",
          questions: [
            { text: "What is the name of the executable found in the Prefetch file?", points: 1, answer: "DLIHOST.EXE" },
            { text: "What was the last execution time? (DD-MM-YYYY HH:MM)", points: 1, answer: "27-11-2024 10:29" },
            { text: "How many times was the program executed?", points: 1, answer: "8" }
          ],
          evidenceFile: "prefetch.pf"
        },
        {
          id: "lab2",
          title: "Lab 2: ShimCache Analysis",
          description: "Examine application compatibility cache entries.",
          difficulty: "intermediate",
          category: "Windows Forensics",
          link: "lab2.html",
          questions: [
            { text: "What is the first executable found in the ShimCache?", points: 1, answer: "EXAMPLE.EXE" },
            { text: "When was the first entry last modified?", points: 1, answer: "01-01-2024 08:30" }
          ],
          evidenceFile: "shimcache.bin"
        },
        {
          id: "lab3",
          title: "Lab 3: Browser History Forensics",
          description: "Investigate browser artifacts for activity analysis.",
          difficulty: "beginner",
          category: "Windows Forensics",
          link: "lab3.html",
          questions: [
            { text: "What was the first website visited?", points: 1, answer: "https://www.google.com" },
            { text: "How many times was the suspicious domain visited?", points: 1, answer: "5" }
          ],
          evidenceFile: "browser_history.zip"
        }
      ];
    }

    // Initialize labs if none exist
    function initLabs() {
      const labs = getLabs();
      if (labs.length === 0) {
        localStorage.setItem('clf_labs', JSON.stringify(getDefaultLabs()));
      }
    }

    // Render labs based on filters
    function renderLabs(filteredLabs = []) {
      const container = document.getElementById('labsContainer');
      let html = '';
      
      // Get current user progress
      const currentUser = getCurrentUsername();
      const user = currentUser ? getCurrentUserObj() : null;
      const progress = user ? user.progress || {} : {};
      
      if (filteredLabs.length === 0) {
        html = '<div class="col-12 text-center"><p>No labs match your search criteria.</p></div>';
      } else {
        filteredLabs.forEach(lab => {
          let badgeClass = 'badge-beginner';
          if (lab.difficulty === 'intermediate') badgeClass = 'badge-intermediate';
          if (lab.difficulty === 'advanced') badgeClass = 'badge-advanced';
          
          // Check if lab is completed
          const labProgress = progress[lab.id];
          const isCompleted = labProgress && labProgress.completedOverall;
          const statusBadge = isCompleted ? 
            '<span class="badge bg-success ms-2">Completed</span>' : '';
          
          html += `
            <div class="col-md-6 mb-4">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">${lab.title} ${statusBadge}</h5>
                  <p class="card-text">${lab.description}</p>
                  <div class="mb-2">
                    <span class="badge ${badgeClass}">${lab.difficulty.charAt(0).toUpperCase() + lab.difficulty.slice(1)}</span>
                    <span class="badge badge-category">${lab.category}</span>
                    <span class="badge bg-info">${lab.questions.length} questions</span>
                  </div>
                  <a href="${lab.link}" class="btn btn-primary float-end">Start Lab</a>
                </div>
              </div>
            </div>
          `;
        });
      }
      
      container.innerHTML = html;
    }

    // Filter labs based on search, difficulty and category
    function filterLabs() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const difficulty = document.getElementById('difficultyFilter').value;
      const category = document.getElementById('categoryFilter').value;
      
      const labs = getLabs();
      const filteredLabs = labs.filter(lab => {
        const matchesSearch = lab.title.toLowerCase().includes(searchTerm) || 
                             lab.description.toLowerCase().includes(searchTerm);
        const matchesDifficulty = difficulty === 'all' || lab.difficulty === difficulty;
        const matchesCategory = category === 'all' || lab.category === category;
        
        return matchesSearch && matchesDifficulty && matchesCategory;
      });
      
      renderLabs(filteredLabs);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize labs if none exist
      initLabs();
      
      // Get all labs and render them
      const labs = getLabs();
      renderLabs(labs);
      
      // Set up event listeners
      document.getElementById('searchInput').addEventListener('input', filterLabs);
      document.getElementById('difficultyFilter').addEventListener('change', filterLabs);
      document.getElementById('categoryFilter').addEventListener('change', filterLabs);
      document.getElementById('searchButton').addEventListener('click', filterLabs);
      
      // Set up category quick filters
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          document.getElementById('categoryFilter').value = category;
          filterLabs();
        });
      });
    });
  </script>
</body>

</html>
